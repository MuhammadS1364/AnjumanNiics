<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Program Info - U1 to U7</title>
  <style>
    /* =========================================
       1. Base Styles
       ========================================= */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Segoe UI", Arial, sans-serif; }
    body { background: #f0f2f5; color: #333; line-height: 1.6; padding-bottom: 50px; }
    
    .container {
      max-width: 900px; margin: 30px auto; background: transparent; padding: 0;
    }
    h1, h2, h3 { text-align: center; margin-bottom: 20px; color: #2c3e50; }

    /* Feedback Boxes */
    .error_box, .success_box {
      display: none; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; font-size: 0.95rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .error_box { background: #ffe6e6; color: #c0392b; border-left: 5px solid #c0392b; }
    .success_box { background: #e6fffa; color: #2c7a7b; border-left: 5px solid #2c7a7b; }

    /* =========================================
       2. Navigation
       ========================================= */
    .navbar {
      background-color: #2c3e50; padding: 15px 0; position: sticky; top: 0; z-index: 100;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .nav-container {
      max-width: 900px; margin: auto; padding: 0 20px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .nav-brand { color: #fff; font-weight: bold; font-size: 1.3rem; text-decoration: none; letter-spacing: 0.5px; }
    .nav-user-info { color: #ecf0f1; font-size: 0.95rem; display: flex; align-items: center; gap: 15px; }
    .btn-logout { background: #e74c3c; color: white; border: none; padding: 6px 15px; border-radius: 4px; cursor: pointer; transition: 0.3s; }
    .btn-logout:hover { background: #c0392b; }

    /* =========================================
       3. Login Screen
       ========================================= */
    .login-card {
      background: white; max-width: 450px; margin: 60px auto; padding: 40px;
      text-align: center; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    .login-tabs { display: flex; margin-bottom: 25px; border-bottom: 2px solid #eee; }
    .login-tab-btn {
      flex:1; padding: 15px; border: none; background: none; font-size: 1rem; font-weight: 600;
      color: #95a5a6; cursor: pointer; transition: 0.3s;
    }
    .login-tab-btn.active { color: #3498db; border-bottom: 3px solid #3498db; }
    .login-input-group { margin-bottom: 15px; text-align: left; }
    .login-input-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 0.9rem; color: #555; }
    .login-input-group input, .login-input-group select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size:1rem; }

    /* =========================================
       4. PREMIUM FORM STYLES
       ========================================= */
    .form-wrapper {
      background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
    }

    .form-section {
      background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 25px;
      margin-bottom: 25px; position: relative;
    }
    .form-section-title {
      font-size: 1.1rem; font-weight: 700; color: #34495e; margin-bottom: 20px;
      padding-bottom: 10px; border-bottom: 2px solid #e0e0e0; display: flex; align-items: center; gap: 10px;
    }
    .section-icon { color: #3498db; }

    /* Grid Layouts */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
    
    label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: #555; }
    input, select, textarea {
      width: 100%; padding: 12px 15px; border: 1px solid #ced4da; border-radius: 6px;
      font-size: 1rem; transition: all 0.3s ease; background: #fff;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #3498db; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1); outline: none;
    }
    textarea { resize: vertical; min-height: 120px; }

    input:disabled, select:disabled { background: #e9ecef; color: #7f8c8d; cursor: not-allowed; font-weight: 500; }

    button.main-btn {
      width: 100%; padding: 16px; background: linear-gradient(135deg, #3498db, #2980b9); color: #fff;
      border: none; border-radius: 8px; font-size: 1.2rem; font-weight: 600; cursor: pointer;
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3); transition: transform 0.2s, box-shadow 0.2s;
    }
    button.main-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(52, 152, 219, 0.4); }
    button.main-btn:active { transform: translateY(0); }
    button.main-btn:disabled { background: #bdc3c7; cursor: not-allowed; transform: none; box-shadow: none; }

    /* Fieldset Styling for Holders */
    fieldset {
      border: 1px solid #ddd; background: #fff; padding: 20px; border-radius: 6px;
    }
    legend {
      font-weight: bold; color: #2c3e50; padding: 0 10px; font-size: 1rem;
    }
    .form-row { display: flex; gap: 15px; margin-bottom: 15px; flex-wrap: wrap; }
    .form-col { flex: 1; min-width: 200px; }

    @media (max-width: 768px) {
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
      .form-row { flex-direction: column; gap: 10px; }
      .form-col { min-width: 100%; }
    }

    /* =========================================
       5. Admin Dashboard Styles
       ========================================= */
    .admin-tabs { display: flex; border-bottom: 2px solid #eee; margin-bottom: 20px; }
    .admin-tab-btn {
      flex:1; padding: 12px; background: none; border: none; font-size: 1rem; font-weight: 600;
      color: #7f8c8d; cursor: pointer; border-bottom: 3px solid transparent;
    }
    .admin-tab-btn:hover { color: #3498db; }
    .admin-tab-btn.active { color: #3498db; border-bottom-color: #3498db; }

    .mini-form { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 25px; border: 1px solid #e9ecef; }
    .mini-form-row { display: flex; gap: 10px; flex-wrap: wrap; }
    .mini-form-row input, .mini-form-row select { flex: 1; }
    .mini-form-row button { padding: 0 20px; background: #27ae60; border: none; color: white; border-radius: 6px; cursor: pointer; min-width: 100px; }

    /* Tables */
    .table-responsive { overflow-x: auto; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
    th { background-color: #f1f2f6; font-weight: 600; color: #2c3e50; }
    .btn-view { background-color: #27ae60; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;}
    .btn-delete { background-color: #e74c3c; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 0.85rem;}

    /* Modal & Toast */
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; }
    .modal.active { opacity: 1; visibility: visible; }
    .modal-content { background: #fff; width: 90%; max-width: 700px; padding: 30px; border-radius: 10px; position: relative; max-height: 90vh; overflow-y: auto; }
    .modal-close { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; cursor: pointer; background: none; border: none; color: #999; }
    .modal-close:hover { color: #333; }
    
    #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 2000; }
    .toast { background: #333; color: #fff; padding: 12px 20px; border-radius: 5px; margin-top: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); animation: slideIn 0.3s; }
    @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

    .hidden { display: none !important; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar hidden" id="main-nav">
    <div class="nav-container">
      <a href="#" class="nav-brand" id="nav-brand-text">Program Collector</a>
      <div class="nav-user-info">
        <span id="user-display-name">Guest</span>
        <button class="btn-logout" onclick="handleLogout()">Logout</button>
      </div>
    </div>
  </nav>

  <!-- VIEW 1: Login Screen -->
  <div id="view-login" class="container">
    <div class="login-card">
      <h1>Welcome</h1>
      <div class="login-tabs">
        <button class="login-tab-btn active" onclick="toggleLoginTab('wing')">Wing Login</button>
        <button class="login-tab-btn" onclick="toggleLoginTab('admin')">Admin Login</button>
      </div>

      <form id="wing-login-form">
        <div class="login-input-group">
          <label>Select Wing</label>
          <select id="login-wing-select" required>
            <option value="" disabled selected>Select your Wing...</option>
          </select>
        </div>
        <div class="login-input-group">
          <label>Username</label>
          <input type="text" id="login-wing-user" placeholder="Enter username" required>
        </div>
        <div class="login-input-group">
          <label>Password</label>
          <input type="password" id="login-wing-pass" placeholder="Enter password" required>
        </div>
        <button type="submit" class="main-btn">Login as Wing Member</button>
      </form>

      <form id="admin-login-form" class="hidden">
        <p style="margin-bottom: 15px; color: #7f8c8d;">Restricted Access</p>
        <div class="login-input-group">
          <label>Admin Password</label>
          <input type="password" id="admin-master-pass" placeholder="Enter Master Password" required>
        </div>
        <button type="submit" class="main-btn" style="background: linear-gradient(135deg, #2c3e50, #34495e);">Login as Admin</button>
      </form>
      
      <!-- Password Hints Removed Here -->
    </div>
  </div>

  <!-- VIEW 2: Wing User Form -->
  <div id="view-form" class="container hidden">
    <h1>Submit Program Report</h1>
    <div class="error_box" id="form-error"></div>
    <div class="success_box" id="form-success"></div>

    <form action="https://sheetdb.io/api/v1/yqs1gvngfhnfs" method="post" id="sheetdb-form" enctype="multipart/form-data" class="form-wrapper">
      
      <!-- Section 1: Basic Info -->
      <div class="form-section">
        <div class="form-section-title"><span class="section-icon">üìÖ</span> Program Overview</div>
        
        <div>
          <label for="Pro_Date">Program Date</label>
            <input type="hidden" name="data[Date]" id="FinalDate">

            <input type="date" id="Pro_Date" required>
        </div>

        <div style="margin-top: 20px;">
          <label for="Wing">Submitting Wing</label>
          <select name="data[Wing Name]" id="Wing"required>
            <option value="">Select...</option>
          </select>
        </div>

        <div style="margin-top: 15px;">
          <label for="Pro_Name">Program Name</label>
          <input type="text" name="data[Pragrame Name]" id="Pro_Name" placeholder="e.g. Annual Science Fair" required>
        </div>
      </div>

      <!-- Section 2: Content -->
      <div class="form-section">
        <div class="form-section-title"><span class="section-icon">üìù</span> Program Details</div>

        <div style="margin-bottom: 15px;">
          <label for="Poster">Program Poster</label>
          <input type="file" name="data[Poster]" id="Poster">
        </div>

        <div style="margin-bottom: 15px;">
          <label for="Pro_Dic">Program Description</label>
          <textarea name="data[Programe Discription]" id="Pro_Dic" placeholder="Describe activities, schedule, and purpose..." required></textarea>
        </div>

        <div>
          <label for="Pro_Outcome">Outcomes</label>
          <textarea name="data[Outcomes]" id="Pro_Outcome" placeholder="What were the results or key takeaways..." required></textarea>
        </div>
      </div>

      <!-- Section 3: Holders (Updated U1-U7) -->
      <div class="form-section">
        <div class="form-section-title"><span class="section-icon">üë•</span> Key Participants</div>
        
        <fieldset>
          <legend>Program Holders</legend>

          <!-- FIRST HOLDER -->
          <div class="form-row">
            <div class="form-col">
              <label>First Holder Class</label>
              <select id="h1_class" name="data[First Holder Class]" onchange="loadStudents(this.value,'list1')" required>
                <option value="" disabled selected>Select Class</option>
                <option value="U7">Class U7</option>
                <option value="U6">Class U6</option>
                <option value="U5">Class U5</option>
                <option value="U4">Class U4</option>
                <option value="U3">Class U3</option>
                <option value="U2">Class U2</option>
                <option value="U1">Class U1</option>
              </select>
            </div>
            <div class="form-col">
              <label>First Holder Name</label>
              <input type="text" name="data[First Holder]" id="firstHolder" list="list1" required>
              <datalist id="list1"></datalist>
            </div>
          </div>

          <!-- SECOND HOLDER -->
          <div class="form-row">
            <div class="form-col">
              <label>Second Holder Class</label>
              <select id="h2_class" name="data[SecondHolder Class]" onchange="loadStudents(this.value,'list2')">
                <option value="" disabled selected>Select Class</option>
                <option value="U7">Class U7</option>
                <option value="U6">Class U6</option>
                <option value="U5">Class U5</option>
                <option value="U4">Class U4</option>
                <option value="U3">Class U3</option>
                <option value="U2">Class U2</option>
                <option value="U1">Class U1</option>
              </select>
            </div>
            <div class="form-col">
              <label>Second Holder Name</label>
              <input type="text" name="data[Second Holder]" id="secondHolder" list="list2">
              <datalist id="list2"></datalist>
            </div>
          </div>

          <!-- THIRD HOLDER -->
          <div class="form-row">
            <div class="form-col">
              <label>Third Holder Class</label>
              <select id="h3_class" name="data[Third  Holder Class]" onchange="loadStudents(this.value,'list3')">
                <option value="" disabled selected>Select Class</option>
                <option value="U7">Class U7</option>
                <option value="U6">Class U6</option>
                <option value="U5">Class U5</option>
                <option value="U4">Class U4</option>
                <option value="U3">Class U3</option>
                <option value="U2">Class U2</option>
                <option value="U1">Class U1</option>
              </select>
            </div>
            <div class="form-col">
              <label>Third Holder Name</label>
              <input type="text" name="data[Third Holder]" id="thirdHolder" list="list3">
              <datalist id="list3"></datalist>
            </div>
          </div>

        </fieldset>
      </div>

      <button type="submit" id="submit-btn" class="main-btn">Save Report</button>
    </form>
  </div>

  <!-- VIEW 3: Admin Dashboard -->
  <div id="view-dashboard" class="container hidden">
    <h1>Admin Dashboard</h1>

    <div class="admin-tabs">
      <button class="admin-tab-btn active" onclick="switchAdminTab('reports')">Reports</button>
      <button class="admin-tab-btn" onclick="switchAdminTab('clubs')">Manage Wings (Creds)</button>
      <button class="admin-tab-btn" onclick="switchAdminTab('users')">Manage Users</button>
    </div>

    <!-- Tab: Reports -->
    <div id="adm-tab-reports" class="tab-content">
      <div class="table-responsive">
        <table id="report-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Program</th>
              <th>Wing</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="report-tbody"></tbody>
        </table>
      </div>
      <div id="report-empty" class="empty-state hidden">No reports found.</div>
    </div>

    <!-- Tab: Clubs -->
    <div id="adm-tab-clubs" class="tab-content hidden">
      <div class="mini-form">
        <h3>Add New Wing with Credentials</h3>
        <form id="add-club-form">
          <div class="mini-form-row">
            <input type="text" id="new-club-name" placeholder="Wing Name" required>
            <input type="text" id="new-club-user" placeholder="Username" required>
            <input type="text" id="new-club-pass" placeholder="Password" required>
            <button type="submit">Add Wing</button>
          </div>
        </form>
      </div>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>Wing Name</th>
              <th>Username</th>
              <th>Password</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="club-tbody"></tbody>
        </table>
      </div>
    </div>

    <!-- Tab: Users -->
    <div id="adm-tab-users" class="tab-content hidden">
      <div class="mini-form">
        <h3>Add New User (Student)</h3>
        <form id="add-user-form">
          <div class="mini-form-row">
            <input type="text" id="new-user-name" placeholder="Student Name" required>
            <button type="submit">Add User</button>
          </div>
        </form>
      </div>
      <div class="table-responsive">
        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="user-tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" id="detail-modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <h2 style="margin-top:0; border-bottom: 2px solid #eee; padding-bottom: 10px;">Report Details</h2>
      <div id="modal-body" style="line-height: 1.8;"></div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast-container"></div>

<script>
  // ===========================
  // 1. Configuration & Data Seeding
  // ===========================
  const ADMIN_PASS = "admin123";
  
  const defaultWings = [
    { name: "Tech Wing", username: "tech", password: "123" },
    { name: "Urdu Wing", username: "urdu", password: "123" },
    { name: "Arabic Wing", username: "arabic", password: "123" },
    { name: "English Wing", username: "english", password: "123" },
    { name: "Math & Science Wing", username: "math", password: "123" },
    { name: "General Knowledge Wing", username: "gk", password: "123" },
    { name: "Tazkiya Wing", username: "tazkiya", password: "123" },
    { name: "Sport Club", username: "sport", password: "123" },
    { nmae: "IEH", username: "ieh", password: 'ieh'},
  ];

  // Student Data (Updated with U6, U4, U2)
  const students = {
    U7: ["Sadaf Ziya","Sufiyan Ahmed Raza","Mohd Sahil","Muhammed Sibgathullah","Md Zeeshan Shaikh","Md Zaid Raza","Abbu Shahma","Gulam Dastageer","Tasuif Ansari","MOHD FAISAL","Md Firoz Alam","Asjad Raza","md mosaheb ali","Md Shamshad","Md Achhe Miyan","Hanzala Maqsoom","Hasan Raza","Thajudheen","Rehan Ahmed","Kaunain","Afran Shaikh","Arsalan","Md Sabir","Ulfat Hussain"],
    U6: ["Ahmed Raza", "Fatima Khan", "Omar Farooq", "Sana Ali", "Bilal Ahmed", "Zara Sheikh", "Imran Khan", "Hina Sadiq", "Rizwan Hussain", "Nasreen Parveen", "Kashif Mehmood", "Shabana Begum", "Tariq Aziz", "Ruqaiya Khan", "Sameer Ahmed", "Nazia Fatima"],
    U5: ["FAHAD AHMAD","ARIF Hussain","JAUHAR TANVIR","MUHAMMAD SHAFEE ALAM","MD RAHMATHULLAH ANSARI","SHEKH NABIL","SHAFEEQURRAHMAN","HASAN RAZA","MO ASAR ALI","Mohammed Rahil","MUHAMMAD SHOAIB ALAM","Abu talib","MD RIZWAN AHMED","FAIZ MOHAMMED PATHAN","MUHAMMED IMRAN RAIN","S SALMAN FARIS","Avesh","MD ASHGAR ALI","ZAID AHMED","AHMED ISMAIL","Md Raihan Raja Noori","Md Aaftab","Arman Khan","Ahmad Raza"],
    U4: ["Ali Khan", "Sara Ahmed", "Usman Ghani", "Ayesha Khan", "Zainab Ali", "Hamza Siddiqui", "Maryam Raza", "Khalid Iqbal", "Sadia Bibi", "Basharat Ali", "Nafees Ahmed", "Shabina Khatun", "Salim Khan", "Zeenat Parveen"],
    U3: ["ARIF IQBAL","AMIR RAZA","SAKLAIN RAZA","MD SIBTEN RAJA","MOHD HARIS","MOHD. ROMAAN","HUSSAIN AKHTAR RAZA","MOHAMMED","SHAHNAWAJ HUSSAIN","SYED DANIYAL HASAN","SUFIYAN AHMAD KARIMI","MD WAQID RAZA","MOHD TANVEER","SHAHANSHAH ALAM","MD LARIAB","MD ADNAN","MD ARSALAN RAZA","SYED ASJAD IQBAL","MOHAMMAD ANSARI","MINHAJ ALAM","MOHD ALI","MD MOHIBUL","MD SAKIR Shaikh","MD AZMAL REHAN","MD MOJAHIR ALI","MD MOINUDDIN","SAHAWAZ ANSARI","TANZIRUL RAHMAN","SHAHNAWAZ NOUSHAD AHMAD","FAIZ RAJA","MD ANAS","HASNAIN AHMED SHEIKH","ATHAR RZA","HAMMAD RAZA SHAIKH","MOHAMMAD AATIF","MD MOGISH RAZA","FARAZ KHAN","MD. ALMOTALI"],
    U2: ["Imran Ali", "Shazia Khan", "Tariq Ahmed", "Farheen Begum", "Nadeem Khan", "Rashida Parveen", "Sohail Ahmed", "Naureen Bibi", "Sajid Khan", "Salma Khatun", "Arif Hussain", "Kausar Parveen"],
    U1: ["Md Azmat Ansari","Aminul Huq","Mishbaul haq","ANAS MAHBOOB","Mohammad zilan Raza multani","Md Chand Babu","Shahadat Babu","Faizan","AAMIR AZIZ","MD FURQUAN","Mohammed Faheem Pathan","MD WASIULLAH","Mo Rehan Raza","Mohd Asad","Abu Hamza","MOHAMMED AZHAN","Mohd Afjal","ZAINI DAHLAN","Md siptan raja","Mohammad Farhan","mohammad azam qadri","Mo. Ahamad","Aawesh Raza","mohammad rumaiz qasim","Faizane Mustafa","ANIS RAJA","Ariz hamza","Mohd Mohiuddin","Mohammad Rehan","Md rehan raja mansuri","Affan Reza","Ashwad Ansari","ZEYAD ALAM","Siftanin Rza","mohammad jaiyadur rabbani","MUHAMMED NIHAL ALI","Muhammed Junais","Tayal Tufail","Mohammad Waqarul Qadri","Tatheer","Anas Khan","AAZAR ALI","Fidaul mustafa","Md Asif Raza"]
  };

  function loadStudents(className, listId) {
    const list = document.getElementById(listId);
    list.innerHTML = "";
    if(students[className]) {
        students[className].forEach(name => {
            const opt = document.createElement("option");
            opt.value = name;
            list.appendChild(opt);
        });
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    let clubs = localStorage.getItem('clubsData');
    if (clubs) {
      clubs = JSON.parse(clubs);
      if (clubs.length > 0 && typeof clubs[0] === 'string') {
        localStorage.setItem('clubsData', JSON.stringify(defaultWings));
      }
    } else {
      localStorage.setItem('clubsData', JSON.stringify(defaultWings));
    }

    if (!localStorage.getItem('usersData')) localStorage.setItem('usersData', JSON.stringify([]));
    if (!localStorage.getItem('programData')) localStorage.setItem('programData', JSON.stringify([]));

    populateLoginWingDropdown();
    populateUserDatalist();
  });

  let currentUser = null;

  // ===========================
  // 2. Navigation & View Logic
  // ===========================
  const views = {
    login: document.getElementById('view-login'),
    form: document.getElementById('view-form'),
    dashboard: document.getElementById('view-dashboard')
  };

  function showView(viewName) {
    Object.values(views).forEach(el => el.classList.add('hidden'));
    views[viewName].classList.remove('hidden');
    if (viewName !== 'login') document.getElementById('main-nav').classList.remove('hidden');
    else document.getElementById('main-nav').classList.add('hidden');
  }

  function toggleLoginTab(type) {
    document.querySelectorAll('.login-tab-btn').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    if (type === 'wing') {
      document.getElementById('wing-login-form').classList.remove('hidden');
      document.getElementById('admin-login-form').classList.add('hidden');
    } else {
      document.getElementById('wing-login-form').classList.add('hidden');
      document.getElementById('admin-login-form').classList.remove('hidden');
    }
  }

  // ===========================
  // 3. Authentication Logic
  // ===========================
  function populateLoginWingDropdown() {
    const clubs = JSON.parse(localStorage.getItem('clubsData'));
    const select = document.getElementById('login-wing-select');
    select.innerHTML = '<option value="" disabled selected>Select your Wing...</option>';
    clubs.forEach(c => select.innerHTML += `<option value="${c.name}">${c.name}</option>`);
  }

  document.getElementById('wing-login-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const wingName = document.getElementById('login-wing-select').value;
    const user = document.getElementById('login-wing-user').value.trim();
    const pass = document.getElementById('login-wing-pass').value.trim();
    const clubs = JSON.parse(localStorage.getItem('clubsData'));
    const wing = clubs.find(c => c.name === wingName);

    if (wing && wing.username === user && wing.password === pass) {
      currentUser = { role: 'wing', wingName: wing.name };
      document.getElementById('user-display-name').textContent = wing.name;
      document.getElementById('nav-brand-text').textContent = "Wing Portal";
      showToast(`Welcome, ${wing.name}`, 'success');
      prepareFormForWing(wing.name);
      showView('form');
    } else {
      showToast('Invalid Username or Password', 'error');
    }
  });

  document.getElementById('admin-login-form').addEventListener('submit', function(e) {
    e.preventDefault();
    if (document.getElementById('admin-master-pass').value.trim() === ADMIN_PASS) {
      currentUser = { role: 'admin' };
      document.getElementById('user-display-name').textContent = "Administrator";
      document.getElementById('nav-brand-text').textContent = "Admin Dashboard";
      showToast('Admin Login Success', 'success');
      renderReports();
      showView('dashboard');
    } else showToast('Incorrect Admin Password', 'error');
  });

  function handleLogout() {
    currentUser = null;
    document.getElementById('wing-login-form').reset();
    document.getElementById('admin-login-form').reset();
    showView('login');
    showToast('Logged out', 'success');
  }

  // ===========================
  // 4. Wing Form Logic
  // ===========================
  function prepareFormForWing(wingName) {
    const wingSelect = document.getElementById('Wing');
    wingSelect.innerHTML = `<option value="${wingName}" selected>${wingName}</option>`;
  }

  const MyForm = document.querySelector("#sheetdb-form");
  const ErrorBox = document.querySelector('.error_box');
  const Poster_Input = document.querySelector('#Poster');

  MyForm.addEventListener("submit", (event) => {
    event.preventDefault();
    let isValid = true;
    MyForm.querySelectorAll('[required]').forEach(field => { if (!field.value.trim()) isValid = false; });
    if (!isValid) {
      ErrorBox.textContent = "Please fill all required fields.";
      ErrorBox.style.display = 'block';
      return;
    }


    // data issu resolved 
    document.getElementById("sheetdb-form").addEventListener("submit", function () {
  const dateInput = document.getElementById("Pro_Date").value;

  // Convert to DD-MM-YYYY
  const d = new Date(dateInput);
  const formatted =
    String(d.getDate()).padStart(2, '0') + "-" +
    String(d.getMonth() + 1).padStart(2, '0') + "-" +
    d.getFullYear();

  document.getElementById("FinalDate").value = formatted;
});


    const btn = document.getElementById('submit-btn');
    btn.disabled = true;
    btn.textContent = 'Saving...';
    ErrorBox.style.display = 'none';

    fetch(MyForm.action, { method: "POST", body: new FormData(MyForm) })
      .then(response => response.json())
      .then(() => {
        const entry = {
          id: Date.now(),
          date: document.getElementById('Pro_Date').value,
          name: document.getElementById('Pro_Name').value,
          wing: document.getElementById('Wing').value,
          poster: Poster_Input.files[0] ? Poster_Input.files[0].name : "No file",
          description: document.getElementById('Pro_Dic').value,
          outcomes: document.getElementById('Pro_Outcome').value,
          h1_name: document.getElementById('firstHolder').value,
          h1_class: document.getElementById('h1_class').value,
          h2_name: document.getElementById('secondHolder').value,
          h2_class: document.getElementById('h2_class').value,
          h3_name: document.getElementById('thirdHolder').value,
          h3_class: document.getElementById('h3_class').value
        };
        
        let data = JSON.parse(localStorage.getItem('programData')) || [];
        data.push(entry);
        localStorage.setItem('programData', JSON.stringify(data));

        showToast('Report Saved Successfully!', 'success');
        MyForm.reset();
        prepareFormForWing(currentUser.wingName);
      })
      .catch(err => {
        console.error(err);
        ErrorBox.textContent = "Network Error.";
        ErrorBox.style.display = 'block';
      })
      .finally(() => {
        btn.disabled = false;
        btn.textContent = 'Save Report';
      });
  });

  // ===========================
  // 5. Admin Dashboard Logic
  // ===========================
  function switchAdminTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
    document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(`adm-tab-${tabName}`).classList.remove('hidden');
    event.target.classList.add('active');
    if (tabName === 'reports') renderReports();
    if (tabName === 'clubs') renderClubsAdmin();
    if (tabName === 'users') renderUsers();
  }

  function renderReports() {
    const data = JSON.parse(localStorage.getItem('programData')) || [];
    const tbody = document.getElementById('report-tbody');
    const emptyMsg = document.getElementById('report-empty');
    tbody.innerHTML = '';
    if (data.length === 0) { emptyMsg.classList.remove('hidden'); document.getElementById('report-table').classList.add('hidden'); return; }
    emptyMsg.classList.add('hidden'); document.getElementById('report-table').classList.remove('hidden');
    
    data.sort((a, b) => new Date(b.date) - new Date(a.date));
    data.forEach(item => {
      const h1 = item.h1_name ? `${item.h1_name} (${item.h1_class})` : '-';
      const h2 = item.h2_name ? `${item.h2_name} (${item.h2_class})` : '';
      const h3 = item.h3_name ? `${item.h3_name} (${item.h3_class})` : '';
      const holders = [h1, h2, h3].filter(n => n).join(', ');

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.date}</td>
        <td><strong>${item.name}</strong></td>
        <td>${item.wing}</td>
        <td>
          <button class="btn-view" onclick="viewDetails(${item.id})">View</button>
          <button class="btn-delete" onclick="deleteReport(${item.id})">Del</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  function deleteReport(id) {
    if(!confirm("Delete this report?")) return;
    let data = JSON.parse(localStorage.getItem('programData')) || [];
    data = data.filter(i => i.id !== id);
    localStorage.setItem('programData', JSON.stringify(data));
    renderReports();
    showToast('Deleted', 'success');
  }

  function renderClubsAdmin() {
    const clubs = JSON.parse(localStorage.getItem('clubsData')) || [];
    const tbody = document.getElementById('club-tbody');
    tbody.innerHTML = '';
    clubs.forEach((c, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${c.name}</td>
        <td><code>${c.username}</code></td>
        <td><code>${c.password}</code></td>
        <td><button class="btn-delete" onclick="deleteClub(${index})">Delete</button></td>`;
      tbody.appendChild(tr);
    });
  }

  document.getElementById('add-club-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('new-club-name').value.trim();
    const user = document.getElementById('new-club-user').value.trim();
    const pass = document.getElementById('new-club-pass').value.trim();
    if (name && user && pass) {
      let clubs = JSON.parse(localStorage.getItem('clubsData')) || [];
      if (clubs.find(c => c.name === name)) { showToast('Wing already exists', 'error'); return; }
      clubs.push({ name, username: user, password: pass });
      localStorage.setItem('clubsData', JSON.stringify(clubs));
      document.getElementById('add-club-form').reset();
      renderClubsAdmin();
      populateLoginWingDropdown();
      showToast('Wing Added', 'success');
    }
  });

  function deleteClub(index) {
    if(!confirm("Delete this Wing?")) return;
    let clubs = JSON.parse(localStorage.getItem('clubsData')) || [];
    clubs.splice(index, 1);
    localStorage.setItem('clubsData', JSON.stringify(clubs));
    renderClubsAdmin();
    populateLoginWingDropdown();
    showToast('Deleted', 'success');
  }

  function renderUsers() {
    const users = JSON.parse(localStorage.getItem('usersData')) || [];
    const tbody = document.getElementById('user-tbody');
    tbody.innerHTML = '';
    users.forEach(u => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${u.name}</td><td><button class="btn-delete" onclick="deleteUser(${u.id})">Del</button></td>`;
      tbody.appendChild(tr);
    });
  }
  document.getElementById('add-user-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('new-user-name').value.trim();
    let users = JSON.parse(localStorage.getItem('usersData')) || [];
    users.push({ id: Date.now(), name: name });
    localStorage.setItem('usersData', JSON.stringify(users));
    e.target.reset();
    renderUsers();
    populateUserDatalist();
    showToast('User Added', 'success');
  });
  function deleteUser(id) {
    if(!confirm("Delete user?")) return;
    let users = JSON.parse(localStorage.getItem('usersData')) || [];
    users = users.filter(u => u.id !== id);
    localStorage.setItem('usersData', JSON.stringify(users));
    renderUsers();
    populateUserDatalist();
  }
  function populateUserDatalist() {
    const users = JSON.parse(localStorage.getItem('usersData')) || [];
    const dl = document.getElementById('user-suggestions');
    if(!dl) return;
    dl.innerHTML = '';
    users.forEach(u => { const opt = document.createElement('option'); opt.value = u.name; dl.appendChild(opt); });
  }

  function viewDetails(id) {
    const data = JSON.parse(localStorage.getItem('programData')) || [];
    const item = data.find(i => i.id === id);
    if(!item) return;
    
    const esc = (txt) => txt ? txt.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;") : '';

    document.getElementById('modal-body').innerHTML = `
      <div style="margin-bottom: 15px; color: #7f8c8d; font-size: 0.9rem; display:flex; gap:15px; align-items:center;">
        <span><strong>Date:</strong> ${item.date}</span>
        <span><strong>Wing:</strong> ${item.wing}</span>
      </div>
      <div style="font-size: 1.2rem; font-weight: bold; color: #2c3e50; margin-bottom: 20px;">
        ${esc(item.name)}
      </div>
      
      <div style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
        <div style="font-weight: bold; color: #333; margin-bottom: 5px;">Description:</div>
        <div style="white-space: pre-wrap;">${esc(item.description)}</div>
      </div>

      <div style="background: #e8f8f5; padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #27ae60;">
        <div style="font-weight: bold; color: #27ae60; margin-bottom: 5px;">Outcomes:</div>
        <div style="white-space: pre-wrap;">${esc(item.outcomes)}</div>
      </div>

      <div style="margin-top: 20px;">
        <div style="font-weight: bold; margin-bottom: 10px;">Participants (with Class):</div>
        <div class="grid-3" style="font-size: 0.95rem; color: #555;">
          <div>1. ${esc(item.h1_name)} <span style="color:#7f8c8d; font-size:0.85rem;">(${item.h1_class})</span></div>
          <div>2. ${esc(item.h2_name)} <span style="color:#7f8c8d; font-size:0.85rem;">(${item.h2_class})</span></div>
          <div>3. ${esc(item.h3_name)} <span style="color:#7f8c8d; font-size:0.85rem;">(${item.h3_class})</span></div>
        </div>
      </div>
    `;
    document.getElementById('detail-modal').classList.add('active');
  }

  function closeModal() { document.getElementById('detail-modal').classList.remove('active'); }
  window.onclick = function(e) { if (e.target == document.getElementById('detail-modal')) closeModal(); }
  
  function showToast(msg, type='success') {
    const t = document.createElement('div'); t.className = 'toast'; 
    t.style.borderLeft = `5px solid ${type=='success'?'#27ae60':'#c0392b'}`;
    t.textContent = msg; document.getElementById('toast-container').appendChild(t);
    setTimeout(() => t.remove(), 3000);
  }
</script>
</body>
</html>